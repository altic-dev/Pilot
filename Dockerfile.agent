# Lightweight Docker image for GitHub repository operations
FROM node:22-alpine

# Install git and GitHub CLI
RUN apk add --no-cache \
    git \
    curl \
    bash \
    openssh-client \
    build-base \
    python3 \
    github-cli

# Install pnpm globally
RUN corepack enable && corepack prepare pnpm@latest --activate

# Set working directory
WORKDIR /workspace

# Create entrypoint script to authenticate GitHub CLI with token
RUN cat > /entrypoint.sh << 'EOF'
#!/bin/sh
if [ -n "$GITHUB_TOKEN" ]; then
  echo "$GITHUB_TOKEN" | gh auth login --with-token
fi
exec "$@"
EOF

RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
CMD ["tail", "-f", "/dev/null"]
